<!doctype html>
<html lang="en">
	{% include "partial/head.html.twig" %}
	<body>
		{% include "partial/navigation.html.twig" %}

		<div class="container">
			<ul class="nav nav-pills gap-3 mb-5">
				<li class="nav-item">
					<a class="nav-link fw-bold bg-secondary text-white" aria-current="page" href="/">
						<i class="fa-sharp fa-light fa-house-medical fa-xl" style="color: #ffffff;"></i> Home
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link fw-bold active bg-primary text-white" href="patient.php">
					<i class="fa-sharp fa-solid fa-users-medical fa-xl"></i> Patients</a>
				</li>
			</ul>

			<!-- Back to view patient medical records-->
			<a href="view-patient-medical-record.php?patient_ID={{ patientDetail.patient_ID }}">
				back to medical records
			</a>

			<!-- Form to add new medical record-->
			<div class="container container-body px-5 py-3 my-3 shadow-sm rounded ">
				<h1 class="text-center mb-5">Upload medical record</h1>

				<form id="createMedicalRecord" method="post" action="add-medical-record.php" enctype="multipart/form-data">

					<input
					type="hidden" name="patient_ID" value="{{patientDetail.patient_ID}}">

					<!-- Start of form -->
					<div class="mb-3 px-3 py-1">
						<label for="mr_time" class="form-label">Time
							<span class="asterisk">*</span>
						</label>
						<input type="text" class="form-control mr_time" name="mr_time" id="mr_time" placeholder="Select date and time" required>
					</div>

					<div class="mb-3 px-3 py-1">
						<label for="mr_title" class="form-label">Type of file</label>
						<span class="asterisk">*</span>
						<select class="form-select" name="mr_title" id="mr_title" required>
							<option value="">Please select types of medical record...</option>
							<option value="advance care directives">Advance care directives</option>
							<option value="diagnostic test">Diagnostic test</option>
							<option value="investigation">Investigation</option>
							<option value="observation">Observation</option>
							<option value="prescription">Prescription</option>
							<option value="general medical record">General medical record</option>
						</select>
					</div>

					<div class="mb-3 px-3 py-1">
						<label for="mr_file" class="form-label">Upload file</label><br>
						<input type="file" class="form-control" name="mr_file" id="mr_file" required>
					</div>
		
					
					<div class="row mb-3 px-3 py-1 displayAndCroppedImage-wrapper" style="display:none;">
						<div class="col-md-6">
							<div class="container source-image-wrapper px-3" style="display:none;border: 1px solid gray;">
								<img class="img-fluid px-0 py-3" src="" id="myImage" alt="" style="max-width:100%; height:500px;">
							</div>
							<div class="container mt-3 cropper-wrapper py-0" style="display:none;">	
								<!-- Crop image -->
								<button class="btn btn-primary" id="cropBtn" type="button">Crop Image</button>
								<!-- Rotate image -->
								<button class="btn btn-primary" id="leftRotateBtn" type="button" name="leftRotateBtn">left</button>
								<button class="btn btn-primary " id="rightRotateBtn" type="button" name="rightRotateBtn">right</button>
								<!-- Reset image -->
								<a href="add-medical-record.php?patient_ID={{patientDetail.patient_ID}}" class="btn btn-secondary">Reset</a>
							</div>
						</div>

						<div class="col-md-6 ">
							<div class="container displayed-image-wrapper px-3" style="display:none; border: 1px solid gray;">
								{# <h3 id="croppedImageResultText" class="text-center mt-5 mb-3" style="display:none;">Cropped image result</h3> #}
								<img class="img-fluid px-0 py-3" id="croppedImage" alt="Cropped image" style="display:none; max-width:100%; height:500px;">
							</div>
							<div class="container mt-3 px-0 py-0 extract-btn-wrapper d-flex justify-content-center" style="display:none;">
								<button class="btn btn-primary" id="convertBtn" type="button" style="display:none;">Extract text</button>
							</div>
						</div>
					</div>


					<div class="mb-3 px-3 py-1" id="resultWrapper" style="display:none;">
						<label for="mr_result" class="form-label">Result
						</label>
						<textarea type="text" class="form-control" name="mr_result" id="mr_result" rows="10" placeholder="Enter results here..."></textarea>
					</div>

					<div class="mb-3 px-3 py-1">
						<label for="mr_text" class="form-label">Comments
						</label>
						<textarea type="text" class="form-control" name="mr_text" id="mr_text" rows="3" placeholder="Enter comments here..."></textarea>
					</div>

					<!-- Add and Cancel button button -->
					<div class="modal-footer">
						{% set outcome = resultsMedicalRecord.errors | join(", ") %}
						<a href="view-patient-medical-record.php?patient_ID={{ patientDetail.patient_ID }}">
							<div class="btn btn-outline-primary">Cancel</div>
						</a>
						<button type="submit" name="add_medicalRecord_btn" class="btn btn-primary" id="add-patient-btn">Add</button>
						{% if outcome | length > 0 %}
							<div class="alert alert-warning alert-dismissible fade show" role="alert">
								{{ outcome }}
								<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
							</div>
						{% endif %}
					</div>
				</form>
			</div>


		</div>
		{% include "partial/footer.html.twig" %}
		{% include "partial/script.html.twig" %}
		<script src="js/patient_medical_record_v5.js" defer></script>
	</body>
</html>
