<!doctype html>
<html lang="en">
	{% include "partial/head.html.twig" %}
	<body>
		{% include "partial/navigation.html.twig" %}
		<div class="container container-body px-5 py-5 shadow-lg rounded">

			<div class="row">
				<div class="col-md-2 side-container">
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link active text-reset" style="margin-left: -1rem;" href="userdashboard.php">Dashboard</a>
						</li>
						
						<li class="nav-item">
							<a class="nav-link active text-reset" style="margin-left: -1rem;" href="createUser.php">
								<strong class="text-primary">Create New User</strong>
							</a>
						</li>

						<li class="nav-item">
							<a class="nav-link active text-reset" style="margin-left: -1rem;" href="edit_account.php">Edit account</a>
						</li>
						
						{% if user_level == 1 %}
							<li class="nav-item">
								<a class="nav-link active text-reset" style="margin-left: -1rem;" href="delete.php" onclick="return confirm('Do you want to delete?')">Delete account</a>
							</li>
						{% endif %}

						{% if user_level == 2 %}
							<li class="nav-item">
								<a class="nav-link active text-reset" style="margin-left: -1rem;" href="view_all_patient.php">View all patient</a>
							</li>
						{% endif %}

						<li class="nav-item">
							<a class="nav-link active text-reset" style="margin-left: -1rem;" onclick="return confirm('Do you want to sign out?')" href="signout.php">Sign out</a>
						</li>
					</ul>
				</div>
				<div class="col-md-10 main-container text-left">
					<h1 class="text-center mb-5">Create New User</h1>
					<form id="createUser" method="post" action="createUser.php" enctype="multipart/form-data">
						<div class="row mb-3">
							<div class="col">
								<label for="firstName" class="form-label">First name
									<span class="asterisk">*</span>
								</label>
								<input type="text" class="form-control" name="firstName" id="firstName" oninput="userInputValid()" aria-label="First name" placeholder="John" required>
							</div>
							<div class="col">
								<label for="lastName" class="form-label">Last name
									<span class="asterisk">*</span>
								</label>
								<input type="text" class="form-control" name="lastName" id="lastName" oninput="userInputValid()" aria-label="Last name" placeholder="Doe" required>
							</div>
						</div>
						<div class="mb-3">
							<label for="userName" class="form-label">User name
								<span class="asterisk">*</span>
							</label>
							<input type="text" class="form-control" name="userName" id="userName" oninput="userInputValid()" placeholder="Enter user name here..." required>
						</div>
						<div class="mb-3">
							<label for="email" class="form-label">Email address
								<span class="asterisk">*</span>
							</label>
							<input type="email" class="form-control" name="email" id="email" oninput="userInputValid()" aria-describedby="emailHelp" pattern="\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*" title="must be a valid email address" placeholder="example@gmail.com" required>
						</div>
						<div class="mb-3">
							<label for="password" class="form-label">Password
								<span class="asterisk">*</span>
							</label>
							<input type="password" class="form-control" name="password" id="password" oninput="userInputValid()" pattern="[A-Za-z0-9!@#$%^&*()-_=+{}'|,<.>/\?]{8,}" title="must be atleast 8 characters" placeholder="minimum 8 characters" required>
						</div>
						<div class="mb-3">
							<label for="contactNumber" class="form-label">Contact number
								<span class="asterisk">*</span>
							</label>
							<input type="text" pattern="\d{6,12}" inputmode="numeric" class="form-control" name="contactNumber" id="contactNumber" oninput="userInputValid()" title="must contain digits only" placeholder="maximum 12 digits" required>
						</div>

						{% if user_level == 2 %}
							<div class="mb-3">
								<label for="profession" class="form-label">User profession</label>
								<span class="asterisk">*</span>
								<select class="custom-select form-control" name="profession" id="profession" oninput="userInputValid()" required>
									<option value="">Please select profession...</option>
									<option value="Doctor">Doctor</option>
									<option value="Nurse">Nurse</option>
									<option value="Pathologist">Pathologist</option>
									<option value="Pharmacist">Pharmacist</option>
									<option value="Dietitian">Dietitian</option>
									<option value="General medical practitioner">Other</option>							
								</select>
							</div>

							<div class="mb-3">
								<label for="userLevel" class="form-label">User level</label>
								<input type="text" class="form-control" name="userLevel" id="userLevel" oninput="userInputValid()" value="3" readonly>
							</div>

							<div class="mb-3">
								<label for="institutionName" class="form-label">Institution name</label>
								<input type="text" class="form-control" name="institutionName" id="institutionName" oninput="userInputValid()" value="{{user_ins_name}}" readonly>
							</div>

							<div class="mb-3">
								<label for="institutionAddress" class="form-label">Institution address
								</label>
								<input type="text" class="form-control" name="institutionAddress" id="institutionAddress" oninput="userInputValid()" value="{{user_ins_add}}" readonly>
							</div>

						{% elseif user_level == 1 %}

							<div class="mb-3">
								<label for="profession" class="form-label">User profession</label>
								<span class="asterisk">*</span>
								<select class="custom-select form-control" name="profession" id="profession" oninput="userInputValid()" required>
									<option value="">Please select profession...</option>								
									<option value="Developer">Developer</option>
									<option value="Administration">Administration</option>
									<option value="Doctor">Doctor</option>
									<option value="Nurse">Nurse</option>
									<option value="Pathologist">Pathologist</option>
									<option value="Pharmacist">Pharmacist</option>
									<option value="Dietitian">Dietitian</option>
									<option value="General medical practitioner">Other</option>
								</select>
							</div>

							<div class="mb-3">
								<label for="userLevel" class="form-label">User level</label>
								<span class="asterisk">*</span>
								<select class="custom-select form-control" name="userLevel" id="userLevel" oninput="userInputValid()" required>
									<option value="">Please select user level...</option>
									<option value="1">1 = Developer</option>
									<option value="2">2 = Administration</option>
									<option value="3">3 = Medical practioners</option>
								</select>
							</div>

							<div id="otherInput" style="display:none;">
								<label for="otherOption">Please specify:</label>
								<input type="text" id="otherOption" name="otherOption">
							</div>

							{# <div class="mb-3">
								<label for="institutionName" class="form-label">Institution name
									<span class="asterisk">*</span>
								</label>
								<input type="text" class="form-control" name="institutionName" id="institutionName" oninput="userInputValid()" placeholder="Enter institution name here..." required>
							</div> #}

							<div class="mb-3">
								<label for="institutionName" class="form-label">Institution name
									<span class="asterisk">*</span>
								</label>
								<select class="form-control" name="institutionName" id="institutionName" oninput="userInputValid()" onchange="handleInstitutionChange()">
									<option value="">Select from the list...</option>
									{% for item in institution.items %}
									<option value="{{item.ins_name}}">{{item.ins_name}} | {{item.ins_add}}</option>
									{% endfor %}
									<option value="others">Others</option>
									{# <input type="text" name="institutionAddress" value="{{item.ins_name}}"> #}
								</select>
								
							</div>

							<div class="mb-3 institutionName-wrapper" id="institutionName-wrapper" style="display: none;">
								<label for="institutionNameInputField" class="form-label">Specify Institution Name</label> <span class="asterisk">*</span>
								<input type="text" class="form-control" name="institutionNameOther" id="institutionNameOther" oninput="userInputValid()" placeholder="Enter institution name here..." required>
							</div>

							<div class="mb-3 institutionAddress-wrapper"id="institutionAddress-wrapper" style="display:none;">
								<label for="institutionAddress" class="form-label">Institution address
									<span class="asterisk">*</span>
								</label>
								<input type="text" class="form-control" name="institutionAddressOther" id="institutionAddressOther" oninput="userInputValid()" placeholder="Enter institution address here..." required>
							</div>

						{% endif %}

						<div class="mb-3">
							<label for="formFile" class="form-label">Choose your profile picture								
							</label>
							<input class="form-control" type="file" name="formFile" id="formFile" onchange="fileValidation()">
						</div>

						{% set outcome = result.errors | join(", ") %}
						
						<div class="modal-footer">
							<a href="userdashboard.php">
								<button type="button" class="btn btn-outline-primary" id="create-cancel-btn">Cancel</button>
							</a>
							<button type="submit" class="btn btn-secondary" id="create-btn" disabled>Create</button>
							{% if outcome | length > 0 %}
								<div class="alert alert-warning alert-dismissible fade show" role="alert">
									{{ outcome }}
									<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
								</div>
							{% endif %}
						</div>
					</form>
				</div>
			</div>
		</div>
		{% include "partial/footer.html.twig" %}
		{% include "partial/script.html.twig" %}
		<script src="js/createUser_v3.js" defer></script>
	</body>
</html>
